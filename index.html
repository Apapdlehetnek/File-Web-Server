<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fájl Feltöltés és Letöltés</title>
</head>
<body>
    <h1>Fájl Feltöltés és Letöltés</h1>

    <!-- Feltöltési mezők -->
    <label for="path">Fájl elérési útja (pl. feltoltesek/fajl.txt):</label>
    <input type="text" id="path" placeholder="feltoltesek/fajl.txt"><br><br>

    <label for="content">Fájl tartalma:</label><br>
    <textarea id="content" rows="4" cols="50" placeholder="Ide írd a fájl tartalmát"></textarea><br><br>

    <button onclick="uploadFile()">Feltöltés</button>
    <button onclick="loadFiles()">Letöltés</button>

    <p id="status"></p>

    <h2>Elérhető fájlok:</h2>
    <ul id="file-list"></ul>

    <script>
        // GitHub repo név és API token - Bizalmas adat, használat után töröld a kódot.
        const repoName = 'Apapdlehetnek/File-Web-Server';
        const token = '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';

        async function uploadFile() {
            const path = document.getElementById('path').value;
            const content = document.getElementById('content').value;

            const url = `https://api.github.com/repos/${repoName}/contents/${path}`;
            const response = await fetch(url, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: 'Fájl feltöltve a GitHub API-val',
                    content: btoa(content),
                })
            });

            if (response.ok) {
                document.getElementById('status').innerText = 'Sikeres feltöltés!';
                loadFiles();
            } else {
                const result = await response.json();
                document.getElementById('status').innerText = `Hiba: ${result.message}`;
            }
        }

        async function loadFiles() {
            const url = `https://api.github.com/repos/${repoName}/contents/`;

            try {
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const files = await response.json();

                if (Array.isArray(files)) {
                    const fileList = document.getElementById('file-list');
                    fileList.innerHTML = '';

                    files.forEach(file => {
                        if (file.type === 'file') {
                            const listItem = document.createElement('li');
                            const link = document.createElement('a');
                            link.href = file.download_url;
                            link.target = '_blank';
                            link.innerText = file.name;
                            listItem.appendChild(link);
                            fileList.appendChild(listItem);
                        }
                    });
                } else {
                    document.getElementById('status').innerText = 'Nem található fájl a megadott repóban.';
                }
            } catch (error) {
                document.getElementById('status').innerText = 'Hiba történt a fájlok betöltése során.';
            }
        }
    </script>
</body>
</html>
